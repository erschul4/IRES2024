---
title: "IRES_micro"
author: "Ella Schulte"
format: html
editor: visual
---

## Quarto

Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>.

## Running Code

When you click the **Render** button a document will be generated that includes both content and the output of embedded code. You can embed code like this:

```{r}
#|label: loading packages
library(tidyverse)
library(readxl)
library(dplyr)
library(janitor)
library(ggplot2)
library(tidyr)
```

```{r}
#|label: loading excel files

#loading in micro abundance file from dropbox
df.micro<- "https://www.dropbox.com/scl/fi/l2jz96yze5u8h50lf8rbj/micro_abundance.xlsx?rlkey=etddasllmna1nim9hu64wwbo3&st=xl6y9bhi&dl=1"
download.file(df.micro, destfile="micro_abundance.xlsx", mode="wb")
df.micro<- read_excel("micro_abundance.xlsx", sheet="micro_fauna_data_cleaned")

#loading in calculated dung decomp file from dropbox
df.baerdecay<- "https://www.dropbox.com/scl/fi/ntldh90n0228d6rujlzrd/baer_decay_calculated.xlsx?rlkey=9bszkjtgtclji8ixgok6fn5pi&st=rion6wb4&dl=1"
download.file(df.baerdecay, destfile="baer_decay_calculated.xlsx", mode="wb")
df.baerdecay<- read_excel("baer_decay_calculated.xlsx", sheet="baer_mass_data_calculations")

```

```{r}
#|label: calculating percentages

# calculating percentages of nematode abundance
# make sure SampleID exists in both frames
# creates nematodepercentage as (NematodeTotalAbundance / CalcFinalDryMass) * 100

df.micro <- df.micro |> dplyr::mutate(.mass = df.baerdecay$`CalcFinalDryMass(g)(calc)`[match(SampleID, df.baerdecay$SampleID)],
    nematodepercentage = dplyr::if_else(.mass > 0, (NematodeTotalAbundance / .mass) * 100, NA_real_)) |> dplyr::select(-.mass)

# make sure SampleID exists in both frames
# creates BFpercentage as (BF / CalcFinalDryMass) * 100

df.micro <- df.micro %>% mutate(.mass = df.baerdecay$`CalcFinalDryMass(g)(calc)`[match(SampleID, df.baerdecay$SampleID)],BFpercentage = if_else(!is.na(.mass) & .mass > 0, (BF / .mass) * 100, NA_real_)) %>% select(-.mass)

# make sure SampleID exists in both frames
# creates FFpercentage as (BF / CalcFinalDryMass) * 100

df.micro <- df.micro %>% mutate(.mass = df.baerdecay$`CalcFinalDryMass(g)(calc)`[match(SampleID, df.baerdecay$SampleID)],FFpercentage = if_else(!is.na(.mass) & .mass > 0, (FF / .mass) * 100, NA_real_)) %>% select(-.mass)

# make sure SampleID exists in both frames
# creates omnipercentage as (omni / CalcFinalDryMass) * 100

df.micro <- df.micro %>% mutate(.mass = df.baerdecay$`CalcFinalDryMass(g)(calc)`[match(SampleID, df.baerdecay$SampleID)],omnipercentage = if_else(!is.na(.mass) & .mass > 0, (omni / .mass) * 100, NA_real_)) %>% select(-.mass)

# make sure SampleID exists in both frames
# creates UKpercentage as (Unknown / CalcFinalDryMass) * 100

df.micro <- df.micro %>% mutate(.mass = df.baerdecay$`CalcFinalDryMass(g)(calc)`[match(SampleID, df.baerdecay$SampleID)],UKpercentage = if_else(!is.na(.mass) & .mass > 0, (Unknown / .mass) * 100, NA_real_)) %>% select(-.mass)
```

```{r}
#|label: creating general visuals

# ordering factors
df.micro <- df.micro %>% mutate(CollectionTime = factor(CollectionTime, levels = c(1, 2, 4), ordered = TRUE), Microsite= factor(Microsite, levels = c("sun","tree")),DungType=factor(DungType,levels=c("cow", "oryx")), WaterTrt = factor(WaterTrt,levels = c(0, 3, 6, 9)))

# long format
long_pct <- df.micro %>% pivot_longer(c(nematodepercentage, BFpercentage, FFpercentage, omnipercentage, UKpercentage),names_to = "metric", values_to = "percent")

#composition percentage graph
comp <- long_pct %>%
  group_by(Microsite, DungType, WaterTrt, CollectionTime, metric) %>%
  summarize(mean = mean(percent, na.rm = TRUE), .groups = "drop")

ggplot(comp, aes(CollectionTime, mean, fill = metric)) +
  geom_col(position = "fill") +
  facet_grid(Microsite + DungType ~ WaterTrt) +
  scale_y_continuous(labels = scales::percent) +
  labs(x = "Collection time", y = "Composition (100%)", fill = "Metric") +
  theme_minimal()

#mean percentage graph
ggplot(comp, aes(CollectionTime, WaterTrt, fill = mean)) +
  geom_tile() +
  facet_grid(metric ~ Microsite + DungType) +
  labs(x = "Collection time", y = "WaterTrt", fill = "Mean %") +
  theme_minimal()

```

```{r}
#|label: creating visuals for nematode total abundance percentage

# ordering factors
df.micro <- df.micro %>%
  mutate(
    CollectionTime = factor(CollectionTime, levels = c(1, 2, 4), ordered = TRUE),
    WaterTrt       = factor(WaterTrt, levels = c(0, 3, 6, 9), ordered = TRUE),
    Microsite      = factor(Microsite, levels = c("sun", "tree")),
    DungType       = factor(DungType,  levels = c("cow", "oryx")), nematodepercentage = suppressWarnings(as.numeric(nematodepercentage)))

#box/violin plot comparing nematode total abundance percentage to microsite, dungtype and watertrt
ggplot(df.micro, aes(Microsite, nematodepercentage, fill = Microsite)) +
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.35, size = 1) +
  facet_grid(DungType ~ WaterTrt) +
  labs(x = "Microsite", y = "Nematode %") +
  coord_cartesian(ylim = c(0, 275)) +
  theme_minimal() +
  guides(fill = "none")

# box plot/violin of nematode total abundance percentage and microsite
ggplot(df.micro, aes(x = Microsite, y = nematodepercentage, fill = Microsite)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  labs(x = "Microsite", y = "Nematode %", title = "Nematode total abundance percentage by microsite") +
  coord_cartesian(ylim = c(0, 275)) +
  theme_minimal() +
  guides(fill = "none")

#box plot/violin of nematode total abundance percentage and collectiontime
ggplot(df.micro, aes(x = CollectionTime, y = nematodepercentage, fill = CollectionTime)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  labs(x = "Collection time", y = "Nematode %", title = "Nematode total abundance % by collection time") +
  coord_cartesian(ylim = c(0, 275)) +
  theme_minimal() +
  guides(fill = "none")

# box plot/violin of nematode total abundance percentage and dungtype
ggplot(df.micro, aes(x = DungType, y = nematodepercentage, fill = DungType)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  labs(x = "Dung type", y = "Nematode %", title = "Nematode total abundance % by dung type") +
  coord_cartesian(ylim = c(0, 275)) +
  theme_minimal() +
  guides(fill = "none")

# box plot/violin of nematode total abundance percentage and water trt
ggplot(df.micro, aes(x = WaterTrt, y = nematodepercentage, fill = WaterTrt)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  labs(x = "Water treatment", y = "Nematode %", title = "Nematode total abundance % by water treatment") +
  coord_cartesian(ylim = c(0, 275)) +
  theme_minimal() +
  guides(fill = "none")

#box/violin comparing nematode total abundance percenatges with collectiontime and water trt
ggplot(df.micro, aes(CollectionTime, nematodepercentage, fill = WaterTrt)) +
  geom_boxplot(position = position_dodge(width = 0.8), outlier.shape = NA, width = 0.6) +
  geom_jitter(position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.12),
              alpha = 0.35, size = 1) +
  labs(x = "Collection time", y = "Nematode %", fill = "WaterTrt",
       title = "Nematode % distribution by time and water treatment") +
  coord_cartesian(ylim = c(0, 275)) +
  theme_minimal()


#box/violin comparing nematode total abundance percenatges with collectiontime and microsite
ggplot(df.micro, aes(CollectionTime, nematodepercentage, fill = Microsite)) +
  geom_boxplot(position = position_dodge(width = 0.8), outlier.shape = NA, width = 0.6) +
  geom_jitter(position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.12),
              alpha = 0.35, size = 1) +
  labs(x = "Collection time", y = "Nematode %", fill = "Microsite",
       title = "Nematode% distribution over time and by microsite") +
  coord_cartesian(ylim = c(0, 275)) +
  theme_minimal()


#box/violin comparing nematode total abundance percenatges with collectiontime and dungtype
ggplot(df.micro, aes(CollectionTime, nematodepercentage, fill = DungType)) +
  geom_boxplot(position = position_dodge(width = 0.8), outlier.shape = NA, width = 0.6) +
  geom_jitter(position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.12),
              alpha = 0.35, size = 1) +
  labs(x = "Collection time", y = "Nematode %", fill = "Dung type",
       title = "Nematode % distribution over time and by dung type") +
  coord_cartesian(ylim = c(0, 275)) +
  theme_minimal()

```

```{r}
#|label: creating visuals for bacterial feeder percentage

# ordering factors
df.micro <- df.micro %>%
  mutate(BFpercentage = suppressWarnings(as.numeric(BFpercentage)))

#box/violin plot comparing bacterial feeder percentage to microsite, dungtype and watertrt
ggplot(df.micro, aes(Microsite, BFpercentage, fill = Microsite)) +
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.35, size = 1) +
  facet_grid(DungType ~ WaterTrt) +
  labs(x = "Microsite", y = "BF %") +
  coord_cartesian(ylim = c(0, 275)) +
  theme_minimal() +
  guides(fill = "none")

# box plot/violin of bacterial feeder percentage and microsite
ggplot(df.micro, aes(x = Microsite, y = BFpercentage, fill = Microsite)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  labs(x = "Microsite", y = "BF %", title = "BF percentage by microsite") +
  coord_cartesian(ylim = c(0, 275)) +
  theme_minimal() +
  guides(fill = "none")

#box plot/violin of bacterial feeder percentage and collectiontime
ggplot(df.micro, aes(x = CollectionTime, y = BFpercentage, fill = CollectionTime)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  labs(x = "Collection time", y = "BF %", title = "BF percentage by collection time") +
  coord_cartesian(ylim = c(0, 275)) +
  theme_minimal() +
  guides(fill = "none")

# box plot/violin of bacterial feeder percentage and dungtype
ggplot(df.micro, aes(x = DungType, y = BFpercentage, fill = DungType)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  labs(x = "Dung type", y = "BF %", title = "BF percentage by dung type") +
  coord_cartesian(ylim = c(0, 275)) +
  theme_minimal() +
  guides(fill = "none")

# box plot/violin of bacterial feeder percentage and water trt
ggplot(df.micro, aes(x = WaterTrt, y = BFpercentage, fill = WaterTrt)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  labs(x = "Water treatment", y = "BF %", title = "BF percentage by water treatment") +
  coord_cartesian(ylim = c(0, 275)) +
  theme_minimal() +
  guides(fill = "none")

#box/violin comparing bacterial feeder percenatges with collectiontime and water trt
ggplot(df.micro, aes(CollectionTime, BFpercentage, fill = WaterTrt)) +
  geom_boxplot(position = position_dodge(width = 0.8), outlier.shape = NA, width = 0.6) +
  geom_jitter(position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.12),
              alpha = 0.35, size = 1) +
  labs(x = "Collection time", y = "BF %", fill = "WaterTrt",
       title = "Nematode % distribution by time and water treatment") +
  coord_cartesian(ylim = c(0, 275)) +
  theme_minimal()

#box/violin comparing bacterial feeder percenatges with collectiontime and microsite
ggplot(df.micro, aes(CollectionTime, BFpercentage, fill = Microsite)) +
  geom_boxplot(position = position_dodge(width = 0.8), outlier.shape = NA, width = 0.6) +
  geom_jitter(position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.12),
              alpha = 0.35, size = 1) +
  labs(x = "Collection time", y = "BF %", fill = "Microsite",
       title = "BF % distribution over time and by microsite") +
  coord_cartesian(ylim = c(0, 275)) +
  theme_minimal()

#box/violin comparing bacterial feeder percenatges with collectiontime and dungtype
ggplot(df.micro, aes(CollectionTime, BFpercentage, fill = DungType)) +
  geom_boxplot(position = position_dodge(width = 0.8), outlier.shape = NA, width = 0.6) +
  geom_jitter(position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.12),
              alpha = 0.35, size = 1) +
  labs(x = "Collection time", y = "BF %", fill = "Dung type",
       title = "BF % distribution over time and by dung type") +
  coord_cartesian(ylim = c(0, 275)) +
  theme_minimal()

```

```{r}
#|label: creating visuals for fungal feeder percentage

# ordering factors
df.micro <- df.micro %>%
  mutate(FFpercentage= suppressWarnings(as.numeric(FFpercentage)))
    
#box/violin plot comparing bacterial feeder percentage to microsite, dungtype and watertrt
ggplot(df.micro, aes(Microsite, FFpercentage, fill = Microsite)) +
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.35, size = 1) +
  facet_grid(DungType ~ WaterTrt) +
  labs(x = "Microsite", y = "FF %") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal() +
  guides(fill = "none")

# box plot/violin of bacterial feeder percentage and microsite
ggplot(df.micro, aes(x = Microsite, y = FFpercentage, fill = Microsite)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  labs(x = "Microsite", y = "FF %", title = "FF percentage by microsite") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal() +
  guides(fill = "none")

#box plot/violin of bacterial feeder percentage and collectiontime
ggplot(df.micro, aes(x = CollectionTime, y = FFpercentage, fill = CollectionTime)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  labs(x = "Collection time", y = "FF %", title = "FF percentage by collection time") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal() +
  guides(fill = "none")

# box plot/violin of bacterial feeder percentage and dungtype
ggplot(df.micro, aes(x = DungType, y = FFpercentage, fill = DungType)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  labs(x = "Dung type", y = "FF %", title = "FF percentage by dung type") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal() +
  guides(fill = "none")

# box plot/violin of bacterial feeder percentage and water trt
ggplot(df.micro, aes(x = WaterTrt, y = FFpercentage, fill = WaterTrt)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  labs(x = "Water treatment", y = "FF %", title = "FF percentage by water treatment") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal() +
  guides(fill = "none")

#box/violin comparing bacterial feeder percenatges with collectiontime and water trt
ggplot(df.micro, aes(CollectionTime, FFpercentage, fill = WaterTrt)) +
  geom_boxplot(position = position_dodge(width = 0.8), outlier.shape = NA, width = 0.6) +
  geom_jitter(position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.12),
              alpha = 0.35, size = 1) +
  labs(x = "Collection time", y = "FF %", fill = "WaterTrt",
       title = "FF % distribution by time and water treatment") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal()

#box/violin comparing bacterial feeder percenatges with collectiontime and microsite
ggplot(df.micro, aes(CollectionTime, FFpercentage, fill = Microsite)) +
  geom_boxplot(position = position_dodge(width = 0.8), outlier.shape = NA, width = 0.6) +
  geom_jitter(position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.12),
              alpha = 0.35, size = 1) +
  labs(x = "Collection time", y = "FF %", fill = "Microsite",
       title = "FF % distribution over time and by microsite ") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal()

#box/violin comparing bacterial feeder percenatges with collectiontime and dungtype
ggplot(df.micro, aes(CollectionTime, FFpercentage, fill = DungType)) +
  geom_boxplot(position = position_dodge(width = 0.8), outlier.shape = NA, width = 0.6) +
  geom_jitter(position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.12),
              alpha = 0.35, size = 1) +
  labs(x = "Collection time", y = "FF %", fill = "Dung type",
       title = " FF % distribution over time and by dung type") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal()

```

```{r}
#|label: creating visuals for omnivore percentage

# numeric coercion
df.micro <- df.micro %>%
  mutate(omnipercentage = suppressWarnings(as.numeric(omnipercentage)))

# box/violin plot comparing omnivore percentage to Microsite, faceted by DungType × WaterTrt
ggplot(df.micro, aes(Microsite, omnipercentage, fill = Microsite)) +
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.35, size = 1) +
  facet_grid(DungType ~ WaterTrt) +
  labs(x = "Microsite", y = "Omni %") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal() +
  guides(fill = "none")

# box/violin of omnivore percentage and Microsite
ggplot(df.micro, aes(x = Microsite, y = omnipercentage, fill = Microsite)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  labs(x = "Microsite", y = "Omni %", title = "Omni percentage by microsite") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal() +
  guides(fill = "none")

# box/violin of omnivore percentage and CollectionTime
ggplot(df.micro, aes(x = CollectionTime, y = omnipercentage, fill = CollectionTime)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  labs(x = "Collection time", y = "Omni %", title = "Omni percentage by collection time") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal() +
  guides(fill = "none")

# box/violin of omnivore percentage and DungType
ggplot(df.micro, aes(x = DungType, y = omnipercentage, fill = DungType)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  labs(x = "Dung type", y = "Omni %", title = "Omni percentage by dung type") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal() +
  guides(fill = "none")

# box/violin of omnivore percentage and WaterTrt
ggplot(df.micro, aes(x = WaterTrt, y = omnipercentage, fill = WaterTrt)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  labs(x = "Water treatment", y = "Omni %", title = "Omni percentage by water treatment") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal() +
  guides(fill = "none")

# box/violin comparing omnivore percentages with CollectionTime and WaterTrt (dodged)
ggplot(df.micro, aes(CollectionTime, omnipercentage, fill = WaterTrt)) +
  geom_boxplot(position = position_dodge(width = 0.8), outlier.shape = NA, width = 0.6) +
  geom_jitter(position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.12),
              alpha = 0.35, size = 1) +
  labs(x = "Collection time", y = "Omni %", fill = "WaterTrt",
       title = "Omni % distribution by time and water treatment") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal()

# box/violin comparing omnivore percentages with CollectionTime and Microsite (dodged)
ggplot(df.micro, aes(CollectionTime, omnipercentage, fill = Microsite)) +
  geom_boxplot(position = position_dodge(width = 0.8), outlier.shape = NA, width = 0.6) +
  geom_jitter(position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.12),
              alpha = 0.35, size = 1) +
  labs(x = "Collection time", y = "Omni %", fill = "Microsite",
       title = "Omni % distribution over time and by microsite") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal()

# box/violin comparing omnivore percentages with CollectionTime and DungType (dodged)
ggplot(df.micro, aes(CollectionTime, omnipercentage, fill = DungType)) +
  geom_boxplot(position = position_dodge(width = 0.8), outlier.shape = NA, width = 0.6) +
  geom_jitter(position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.12),
              alpha = 0.35, size = 1) +
  labs(x = "Collection time", y = "Omni %", fill = "Dung type",
       title = "Omni % distribution over time and by dung type") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal()

```

```{r}
#|label: creating visuals for unknown group percentage

# numeric coercion
df.micro <- df.micro %>%
  mutate(UKpercentage = suppressWarnings(as.numeric(UKpercentage)))

# box/violin plot comparing UK % to Microsite, faceted by DungType × WaterTrt
ggplot(df.micro, aes(Microsite, UKpercentage, fill = Microsite)) +
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.35, size = 1) +
  facet_grid(DungType ~ WaterTrt) +
  labs(x = "Microsite", y = "UK %") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal() +
  guides(fill = "none")

# box/violin of UK % and Microsite
ggplot(df.micro, aes(x = Microsite, y = UKpercentage, fill = Microsite)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  labs(x = "Microsite", y = "UK %", title = "UK percentage by microsite") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal() +
  guides(fill = "none")

# box/violin of UK % and CollectionTime
ggplot(df.micro, aes(x = CollectionTime, y = UKpercentage, fill = CollectionTime)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  labs(x = "Collection time", y = "UK %", title = "UK percentage by collection time") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal() +
  guides(fill = "none")

# box/violin of UK % and DungType
ggplot(df.micro, aes(x = DungType, y = UKpercentage, fill = DungType)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  labs(x = "Dung type", y = "UK %", title = "UK percentage by dung type") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal() +
  guides(fill = "none")

# box/violin of UK % and WaterTrt
ggplot(df.micro, aes(x = WaterTrt, y = UKpercentage, fill = WaterTrt)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  labs(x = "Water treatment", y = "UK %", title = "UK percentage by water treatment") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal() +
  guides(fill = "none")

# box/violin comparing UK % with CollectionTime and WaterTrt (dodged)
ggplot(df.micro, aes(CollectionTime, UKpercentage, fill = WaterTrt)) +
  geom_boxplot(position = position_dodge(width = 0.8), outlier.shape = NA, width = 0.6) +
  geom_jitter(position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.12),
              alpha = 0.35, size = 1) +
  labs(x = "Collection time", y = "UK %", fill = "WaterTrt",
       title = "UK % distribution by time and water treatment") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal()

# box/violin comparing UK % with CollectionTime and Microsite (dodged)
ggplot(df.micro, aes(CollectionTime, UKpercentage, fill = Microsite)) +
  geom_boxplot(position = position_dodge(width = 0.8), outlier.shape = NA, width = 0.6) +
  geom_jitter(position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.12),
              alpha = 0.35, size = 1) +
  labs(x = "Collection time", y = "UK %", fill = "Microsite",
       title = "UK % distribution over time and by microsite") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal()

# box/violin comparing UK % with CollectionTime and DungType (dodged)
ggplot(df.micro, aes(CollectionTime, UKpercentage, fill = DungType)) +
  geom_boxplot(position = position_dodge(width = 0.8), outlier.shape = NA, width = 0.6) +
  geom_jitter(position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.12),
              alpha = 0.35, size = 1) +
  labs(x = "Collection time", y = "UK %", fill = "Dung type",
       title = "UK % distribution over time and by dung type") +
  coord_cartesian(ylim = c(0, 100)) +
  theme_minimal()

```

```{r}
#|label: creating visuals comparing BF,FF,omni and UK %

# visuals for comparison between % and water trt

#order factors
df.micro <- df.micro %>%
  mutate(
    WaterTrt = factor(WaterTrt, levels = c(0,3,6,9), ordered = TRUE),
    across(c(BFpercentage, FFpercentage, omnipercentage, UKpercentage),
           ~ suppressWarnings(as.numeric(.))))

# long format
long_pct_comp <- df.micro %>%
  pivot_longer(
    c(BFpercentage, FFpercentage, omnipercentage, UKpercentage),
    names_to = "metric", values_to = "percent")

# box plot comparison between % and water trt
ggplot(long_pct_comp, aes(x = WaterTrt, y = percent, fill = WaterTrt)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  facet_wrap(~ metric, ncol = 2, scales = "free_y") +
  labs(x = "Water treatment", y = "Percent", title = "Distributions by metric and WaterTrt") +
  theme_minimal() +
  guides(fill = "none")

# composition map comparison between % and water trt
comp <- long_pct_comp %>%
  group_by(WaterTrt, metric) %>%
  summarize(mean_pct = mean(percent, na.rm = TRUE), .groups = "drop")

ggplot(comp, aes(WaterTrt, mean_pct, fill = metric)) +
  geom_col(position = "fill") +
  scale_y_continuous(labels = scales::percent) +
  labs(x = "Water treatment", y = "Composition (100%)", fill = "Metric",
       title = "Relative composition of metrics by WaterTrt") +
  theme_minimal()

# visuals for comparison between % and collection time

# order factors
df.micro <- df.micro %>%
  mutate(
    CollectionTime = factor(CollectionTime, levels = c(1, 2, 4), ordered = TRUE),
    across(c(BFpercentage, FFpercentage, omnipercentage, UKpercentage),
           ~ suppressWarnings(as.numeric(.))))

# long format
long_pct_comp <- df.micro %>%
  tidyr::pivot_longer(
    c(BFpercentage, FFpercentage, omnipercentage, UKpercentage),
    names_to = "metric", values_to = "percent")

# box plot comparison between % and collection time
ggplot(long_pct_comp, aes(x = CollectionTime, y = percent, fill = CollectionTime)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  facet_wrap(~ metric, ncol = 2, scales = "free_y") +
  labs(x = "Collection time", y = "Percent",
       title = "Distributions by metric and CollectionTime") +
  theme_minimal() +
  guides(fill = "none")

# composition map comparison between % and collection time
comp <- long_pct_comp %>%
  dplyr::group_by(CollectionTime, metric) %>%
  dplyr::summarize(mean_pct = mean(percent, na.rm = TRUE), .groups = "drop")

ggplot(comp, aes(CollectionTime, mean_pct, fill = metric)) +
  geom_col(position = "fill") +
  scale_y_continuous(labels = scales::percent) +
  labs(x = "Collection time", y = "Composition (100%)", fill = "Metric",
       title = "Relative composition of metrics by CollectionTime") +
  theme_minimal()

# visuals for comparison between % and dungtype

# order factors
df.micro <- df.micro %>%
  mutate(
    DungType = factor(DungType, levels = c("cow", "oryx")),
    across(c(BFpercentage, FFpercentage, omnipercentage, UKpercentage),
           ~ suppressWarnings(as.numeric(.))))

# box plot comparison between % and dungtype
ggplot(long_pct_comp, aes(x = DungType, y = percent, fill = DungType)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  facet_wrap(~ metric, ncol = 2, scales = "free_y") +
  labs(x = "Dung type", y = "Percent",
       title = "Distributions by metric and DungType") +
  theme_minimal() +
  guides(fill = "none")

# composition map comparison between % and dungtype
comp <- long_pct_comp %>%
  group_by(DungType, metric) %>%
  summarize(mean_pct = mean(percent, na.rm = TRUE), .groups = "drop")

ggplot(comp, aes(DungType, mean_pct, fill = metric)) +
  geom_col(position = "fill") +
  scale_y_continuous(labels = scales::percent) +
  labs(x = "Dung type", y = "Composition (100%)", fill = "Metric",
       title = "Relative composition of metrics by DungType") +
  theme_minimal()

# visuals for comparison between % and microsite

# order factors
df.micro <- df.micro %>%
  mutate(
    Microsite = factor(Microsite, levels = c("sun", "tree")),
    across(c(BFpercentage, FFpercentage, omnipercentage, UKpercentage),
           ~ suppressWarnings(as.numeric(.))))

# box plot comparison between % and microsite
ggplot(long_pct_comp, aes(x = Microsite, y = percent, fill = Microsite)) +
  geom_violin(trim = FALSE, alpha = 0.25) +
  geom_boxplot(width = 0.18, outlier.shape = NA) +
  geom_jitter(width = 0.12, alpha = 0.25, size = 1) +
  facet_wrap(~ metric, ncol = 2, scales = "free_y") +
  labs(x = "Microsite", y = "Percent",
       title = "Distributions by metric and Microsite") +
  theme_minimal() +
  guides(fill = "none")

# composition map comparison between % and microsite
comp <- long_pct_comp %>%
  group_by(Microsite, metric) %>%
  summarize(mean_pct = mean(percent, na.rm = TRUE), .groups = "drop")

ggplot(comp, aes(Microsite, mean_pct, fill = metric)) +
  geom_col(position = "fill") +
  scale_y_continuous(labels = scales::percent) +
  labs(x = "Microsite", y = "Composition (100%)", fill = "Metric",
       title = "Relative composition of metrics by Microsite") +
  theme_minimal()

```

